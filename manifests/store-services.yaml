apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: store-ingress
  namespace: storeapptest
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web              # Define o ponto de entrada HTTP (porta 80)
    traefik.ingress.kubernetes.io/router.priority: "10"                # Define a prioridade da rota
    traefik.ingress.kubernetes.io/rewrite-target: /                    # Define o destino da reescrita de URL
    traefik.ingress.kubernetes.io/weighted-services: '{"store-front": 80, "store-grpc": 20}'  # Balanceamento de carga 80/20
spec:
  rules:
  - host: storefrontsdproject.com                                      # Domínio que será acessado
    http:
      paths:
      - path: /                                                          # Caminho raiz
        pathType: Prefix
        backend:
          service:
            name: store-front                                            # Serviço que recebe 80% do tráfego
            port:
              number: 80                                                 # Porta do serviço front-end
      - path: /                                                          # Caminho raiz também
        pathType: Prefix
        backend:
          service:
            name: store-grpc                                            # Serviço que recebe 20% do tráfego
            port:
              number: 80                                                 # Porta do serviço gRPC
